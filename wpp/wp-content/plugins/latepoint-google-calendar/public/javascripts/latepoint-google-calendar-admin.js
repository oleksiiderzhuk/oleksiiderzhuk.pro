class LatepointGoogleCalendarAddon{constructor(){this.init()}booking_synced(e){e.closest(".os-booking-tiny-box").removeClass("not-synced").addClass("is-synced"),this.sync_update_progress(e.closest(".syncing-calendar-wrapper").find(".os-sync-stats-and-progress-w"),!1)}gcal_event_deleted(e){e.closest(".os-booking-tiny-box").remove()}booking_unsynced(e){e.closest(".os-booking-tiny-box").addClass("not-synced").removeClass("is-synced"),this.sync_update_progress(e.closest(".syncing-calendar-wrapper").find(".os-sync-stats-and-progress-w"),!0)}sync_update_progress(e,o){var a=e.find(".os-sync-value span").text();a=o?parseInt(a)-1:parseInt(a)+1,e.find(".os-sync-value span").text(a),e.find(".os-sync-progress").data("value",a);var s=e.find(".os-sync-progress").data("total"),t=e.find(".os-sync-progress").data("value");if(s>0){var n=Math.min(Math.round(t/s*100),100);e.find(".os-sync-progress-bar").css("width",n+"%")}}remove_first_synced_booking_with_google(){var e=jQuery(".os-booking-tiny-box.is-synced:first .os-booking-sync-google-trigger");if(!e.length||jQuery(".remove-all-bookings-from-google-trigger").hasClass("stop-removing"))return jQuery(".remove-all-bookings-from-google-trigger").removeClass("os-removing").removeClass("stop-removing").find("span").text(jQuery(".remove-all-bookings-from-google-trigger").data("label-remove")),!1;var o=e.data("os-remove-action"),a=e.data("os-params"),s={action:latepoint_helper.route_action,route_name:o,params:a,layout:"none",return_format:"json"};e.addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:s,success:function(o){"success"===o.status&&(e.closest(".os-booking-tiny-box").removeClass("is-synced").addClass("not-synced"),e.removeClass("os-loading"),latepointGoogleCalendar.sync_update_progress(e.closest(".syncing-calendar-wrapper").find(".os-sync-stats-and-progress-w"),!0),latepointGoogleCalendar.remove_first_synced_booking_with_google())}})}sync_next_booking_with_google(){var e=jQuery(".os-booking-tiny-box.not-synced:first .os-booking-sync-google-trigger");if(!e.length||jQuery(".sync-all-bookings-to-google-trigger").hasClass("stop-syncing"))return jQuery(".sync-all-bookings-to-google-trigger").removeClass("os-syncing").removeClass("stop-syncing").find("span").text(jQuery(".sync-all-bookings-to-google-trigger").data("label-sync")),!1;var o=e.data("os-action"),a=e.data("os-params"),s={action:latepoint_helper.route_action,route_name:o,params:a,layout:"none",return_format:"json"};e.addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:s,success:function(o){"success"===o.status&&(e.closest(".os-booking-tiny-box").removeClass("not-synced").addClass("is-synced"),e.removeClass("os-loading"),latepointGoogleCalendar.sync_update_progress(e.closest(".syncing-calendar-wrapper").find(".os-sync-stats-and-progress-w"),!1),latepointGoogleCalendar.sync_next_booking_with_google())}})}init(){jQuery(document).ready((()=>{if(jQuery("select.agent_google_calendar_selector").on("change",(function(e){var o=jQuery(this).data("route"),a=jQuery(this).val(),s=jQuery(this).data("agent-id"),t={action:latepoint_helper.route_action,route_name:o,params:{calendar_id:a,agent_id:s},layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:t,success:function(e){"success"===e.status?(latepoint_add_notification(e.message),location.reload()):alert("Error! Connecting calendar for push failed.")}})})),jQuery(".sync-all-bookings-to-google-trigger").on("click",(function(){return jQuery(this).hasClass("os-syncing")?(jQuery(this).addClass("stop-syncing"),jQuery(this).find("span").text(jQuery(this).data("label-sync"))):(jQuery(this).find("span").text(jQuery(this).data("label-cancel-sync")),jQuery(this).addClass("os-syncing"),latepointGoogleCalendar.sync_next_booking_with_google()),!1})),jQuery(".remove-all-bookings-from-google-trigger").on("click",(function(){if(jQuery(this).hasClass("os-removing"))jQuery(this).addClass("stop-removing"),jQuery(this).find("span").text(jQuery(this).data("label-remove"));else{if(!confirm(jQuery(this).data("os-prompt")))return!1;jQuery(this).find("span").text(jQuery(this).data("label-cancel-remove")),jQuery(this).addClass("os-removing"),latepointGoogleCalendar.remove_first_synced_booking_with_google()}return!1})),jQuery('.calendar-available-for-sync input[type="hidden"]').on("change",(function(){var e=jQuery(this).closest(".calendar-available-for-sync"),o=e.data("route"),a=e.data("calendar-id"),s=e.data("agent-id"),t={action:latepoint_helper.route_action,route_name:o,params:{calendar_id:a,agent_id:s},return_format:"json"};e.addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:t,success:function(o){e.removeClass("os-loading"),"success"===o.status?(latepoint_add_notification(o.message),location.reload()):alert(o.message,"error")}})})),latepoint_helper.google_calendar_is_enabled&&jQuery("#google-signin-button").length){const e=google.accounts.oauth2.initCodeClient({client_id:latepoint_helper.google_calendar_client_id,scope:"https://www.googleapis.com/auth/calendar",ux_mode:"popup",callback:this.saveAuthCode});jQuery("#google-signin-button").on("click",(function(){e.requestCode()}))}}))}saveAuthCode(e){var o={code:e.code,agent_id:jQuery("#google-signin-button").data("agent-id")},a={action:"latepoint_route_call",route_name:jQuery("#google-signin-button").data("route"),params:o,layout:"none",return_format:"json"};jQuery.ajax({type:"POST",url:latepoint_helper.ajaxurl,dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"},data:a,success:function(e){latepoint_add_notification(e.message),location.reload()}})}}latepointGoogleCalendar=new LatepointGoogleCalendarAddon;